#!/usr/bin/env python
# -*-coding=utf-8-*-
import datetime
import os
import h5py
import numpy as np

if __name__ == '__main__':



    bandNum = 16
    noise = {
        'percentage': 0.015323,

    }

    Es = {
        '6': 227.610016,
        '7': 96.128685,
        '8': 1747.423828,
        '9': 2091.292236,
        '10': 2007.279907,
        '11': 1809.238281,
        '12': 1783.836426,
        '13': 1589.418457,
        '14': 1458.891968,
        '15': 1239.619995,
        '16': 1000.900696,
        '17': 879.074219,
        '18': 825.863525,
        '19': 759.742310,
        '20': 692.119019,
    }
    # 0327原R
    S0 = {
        '6':0.069504556,
        '7':0.062623748,
        '8':0.423415687,
        '9':0.349687233,
        '10':0.303696081,
        '11':0.245302698,
        '12':0.160954735,
        '13':0.146376194,
        '14':0.133610514,
        '15':0.109948634,
        '16':0.118449492,
        '17':0.124682871,
        '18':0.128488914,
        '19':0.130047927,

    }

    # R-5%
    S1 = {
        '6':0.067744661,
        '7':0.06103808,
        '8':0.412694563,
        '9':0.340832954,
        '10':0.296006325,
        '11':0.239091495,
        '12':0.156879271,
        '13':0.142669866,
        '14':0.13022742,
        '15':0.107164673,
        '16':0.115450284,
        '17':0.12152583,
        '18':0.125235502,
        '19':0.12675504,
    }

    # R+5%
    S2 = {
        '6':0.071220976,
        '7':0.064170247,
        '8':0.43387197,
        '9':0.358322786,
        '10':0.311195879,
        '11':0.251360467,
        '12':0.164929525,
        '13':0.149990966,
        '14':0.136910036,
        '15':0.112663824,
        '16':0.121374611,
        '17':0.127761924,
        '18':0.131661958,
        '19':0.133259471,

    }




    begin = datetime.date(2015, 7, 29)
    end = datetime.date(2015, 7, 29)

    if end==datetime.date(2015,3,27):
        S0={
            '6':0.05755524,
            '7':0.054233757,
            '8':0.388634456,
            '9':0.320924578,
            '10':0.278619691,
            '11':0.224852926,
            '12':0.146880948,
            '13':0.13315333,
            '14':0.121097987,
            '15':0.098392576,
            '16':0.105558599,
            '17':0.111038021,
            '18':0.114393149,
            '19':0.11539041,

        }
        # R-5%
        S1 = {
            '6':0.056097909,
            '7':0.052860528,
            '8':0.378794012,
            '9':0.312798586,
            '10':0.271564883,
            '11':0.219159522,
            '12':0.143161839,
            '13':0.129781812,
            '14':0.118031718,
            '15':0.09590122,
            '16':0.102885796,
            '17':0.108226475,
            '18':0.11149665,
            '19':0.112468659,

        }
        # R+5%
        S2 = {
            '6':0.058976572,
            '7':0.055573064,
            '8':0.398231813,
            '9':0.328849835,
            '10':0.285500225,
            '11':0.230405686,
            '12':0.150508184,
            '13':0.136441562,
            '14':0.124088512,
            '15':0.100822388,
            '16':0.108165377,
            '17':0.113780113,
            '18':0.117218096,
            '19':0.118239985,

        }


    for i in range((end - begin).days + 1):
        day = begin + datetime.timedelta(days=i)
        day = str(day).split("-")
        day = "".join(day)
        dir_path = '/RED1BDATA_A/SNR/XWW/file/Amer_West/3B/{}/Band{}/'.format(day, bandNum)
        file_list = os.listdir(dir_path)
        print os.path.join(dir_path, file_list[0])
        for filename in file_list:

            file_path = dir_path + filename
            file_data = h5py.File(file_path, 'r')
            try:
                ori_refFactor = file_data['RefFactor_3_GlintMask'][:]
                new_refFactor = ori_refFactor[np.where(ori_refFactor != 0)]
                ref = new_refFactor * 0.01
                print ref.shape

                # exit(-1)
            except:
                print 'file error!'

    SZA_mean = np.round(np.nanmean(ref), 5)
    SZA_std = np.round(np.nanstd(ref), 5)
    N2 = noise['percentage']/100 * S2[str(bandNum)] / np.sqrt(SZA_mean)
    SNR = (SZA_mean) / N2
    print ''.center(80, '*')
    print u'人工区域统计'
    print u'SNR：', SNR
    print u'相对噪声：',N2


    print 'mean: ', SZA_mean
    print 'std:  ', SZA_std






